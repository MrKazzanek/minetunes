<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator plików songs.json i albums.json</title>
    <style>
        :root {
            --primary-bg: #1e1e1e;
            --secondary-bg: #2d2d2d;
            --tertiary-bg: #3c3c3c;
            --text-color: #dcdcdc;
            --primary-color: #4a90e2;
            --border-color: #555;
            --success-color: #5cb85c;
            --danger-color: #d9534f;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--primary-bg);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--secondary-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        h1, h2, h3 {
            color: #fff;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
        }

        .section {
            background-color: var(--tertiary-bg);
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 25px;
        }
        
        .info-box {
            background-color: rgba(74, 144, 226, 0.1);
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            background-color: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-color);
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
        }
        
        input[readonly] {
            background-color: #333;
            cursor: not-allowed;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: "Courier New", Courier, monospace;
            font-size: 14px;
        }

        button {
            display: inline-block;
            width: auto;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            color: #fff;
            background-color: var(--primary-color);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #5aa1f2;
        }
        
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        
        #generateBtn {
            width: 100%;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .hidden {
            display: none;
        }

        .radio-group label {
            display: inline-block;
            margin-right: 20px;
            font-weight: normal;
        }
        .radio-group input {
            margin-right: 5px;
        }

        .sub-section {
            border-left: 3px solid var(--primary-color);
            padding-left: 15px;
            margin-top: 15px;
        }

        .song-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 4px;
            background-color: var(--primary-bg);
        }
        .song-list label {
            font-weight: normal;
        }
        .song-list input {
            margin-right: 8px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Generator JSON dla Piosenek i Albumów</h1>

        <div class="info-box">
            <p><strong>Witaj!</strong> Ta strona automatycznie wczytała Twoje pliki <code>songs.json</code> i <code>albums.json</code> z tego samego folderu.</p>
            <p>Po wygenerowaniu kodu, użyj przycisków <strong>"Pobierz"</strong>, aby zapisać zaktualizowane pliki na swoim komputerze.</p>
        </div>

        <!-- SEKCJA 1: DODAWANIE UTWORU -->
        <div class="section">
            <h2>1. Dodaj Nowy Utwór</h2>
            <div id="songForm" class="grid">
                <div>
                    <label for="songArtist">Nazwa autora</label>
                    <input type="text" id="songArtist" placeholder="np. Lena Raine">
                </div>
                <div>
                    <label for="songTitle">Nazwa muzyki</label>
                    <input type="text" id="songTitle" placeholder="np. Otherside">
                </div>
                <div class="full-width">
                    <label for="songId">Wygenerowane ID (tylko do odczytu)</label>
                    <input type="text" id="songId" readonly>
                </div>
                <div>
                    <label for="songSrc">Nazwa pliku muzycznego (w folderze /music)</label>
                    <input type="text" id="songSrc" placeholder="np. otherside.mp3">
                </div>
                <div>
                    <label for="songCover">Nazwa pliku okładki (w folderze /images)</label>
                    <input type="text" id="songCover" placeholder="np. otherside.jpg">
                </div>
                <div>
                    <label for="songGenre">Gatunek (oddzielone przecinkami)</label>
                    <input type="text" id="songGenre" placeholder="np. Music Disc, Electronic">
                </div>
                <div>
                    <label for="songVersion">Wersja dodania</label>
                    <input type="text" id="songVersion" placeholder="np. 1.18">
                </div>
                <div class="full-width">
                    <label for="songDuration">Czas trwania (w sekundach)</label>
                    <input type="number" id="songDuration" placeholder="np. 195">
                </div>
            </div>
        </div>

        <!-- SEKCJA 2: OPCJE ALBUMU -->
        <div class="section">
            <h2>2. Opcje Albumu</h2>
            <div id="albumOptions" class="radio-group">
                <label><input type="radio" name="albumAction" value="none" checked> a) Nie dodawaj do albumu</label>
                <label><input type="radio" name="albumAction" value="existing"> b) Dodaj do istniejącego albumu</label>
                <label><input type="radio" name="albumAction" value="new"> c) Utwórz nowy album i przypisz utwór</label>
                <label><input type="radio" name="albumAction" value="manage"> d) Zarządzaj albumami (bez dodawania utworu)</label>
            </div>

            <!-- Ukryte sekcje dla opcji B, C, D -->
            <div id="actionExisting" class="sub-section hidden">
                <h3>b) Wybierz istniejący album</h3>
                <select id="existingAlbumsSelect"></select>
            </div>

            <div id="actionNew" class="sub-section hidden">
                <h3>c) Utwórz nowy album</h3>
                <label for="newAlbumTitle">Tytuł albumu (wymagane)</label>
                <input type="text" id="newAlbumTitle" placeholder="np. Minecraft Tricky Trials">
                <label for="newAlbumDesc">Opis (opcjonalnie)</label>
                <input type="text" id="newAlbumDesc">
                <label for="newAlbumCover">Okładka (w folderze /album-images, opcjonalnie)</label>
                <input type="text" id="newAlbumCover" placeholder="np. tricky_trials.png">
                <label>Dodaj również inne istniejące utwory:</label>
                <div id="newAlbumSongList" class="song-list"></div>
            </div>

            <div id="actionManage" class="sub-section hidden">
                <h3>d) Zarządzaj albumami</h3>
                <p style="color: #ffcc00;">Uwaga: Wybranie tej opcji sprawi, że formularz dodawania utworu powyżej zostanie zignorowany po kliknięciu "Generuj kod".</p>
                <select id="manageAlbumSelect">
                    <option value="--create--">-- UTWÓRZ NOWY ALBUM --</option>
                    <option value="--delete--">-- USUŃ ISTNIEJĄCY ALBUM --</option>
                </select>

                <div id="manageAlbumForm">
                    <label for="manageAlbumTitle">Tytuł albumu</label>
                    <input type="text" id="manageAlbumTitle">
                    <label for="manageAlbumDesc">Opis</label>
                    <input type="text" id="manageAlbumDesc">
                    <label for="manageAlbumCover">Okładka</label>
                    <input type="text" id="manageAlbumCover">
                    <label>Wybierz utwory dla tego albumu:</label>
                    <div id="manageAlbumSongList" class="song-list"></div>
                </div>
                 <div id="deleteAlbumSection" class="hidden">
                    <label for="deleteAlbumSelect">Wybierz album do usunięcia:</label>
                    <select id="deleteAlbumSelect"></select>
                </div>
            </div>
        </div>

        <!-- SEKCJA 3: GENEROWANIE -->
        <div class="section">
            <h2>3. Generuj Kod</h2>
            <button id="generateBtn">Generuj kod JSON</button>
        </div>

        <!-- SEKCJA 4: WYNIK -->
        <div class="section">
            <h2>Wynik</h2>
            <div class="grid">
                <div>
                    <div class="output-header">
                        <label for="outputSongsJson">Nowa zawartość dla <u>songs.json</u></label>
                        <button id="downloadSongsBtn" disabled>Pobierz</button>
                    </div>
                    <textarea id="outputSongsJson" readonly></textarea>
                </div>
                <div>
                    <div class="output-header">
                        <label for="outputAlbumsJson">Nowa zawartość dla <u>albums.json</u></label>
                        <button id="downloadAlbumsBtn" disabled>Pobierz</button>
                    </div>
                    <textarea id="outputAlbumsJson" readonly></textarea>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- GLOBALNY STAN APLIKACJI ---
        let songsData = [];
        let albumsData = [];

        // --- REFERENCJE DO ELEMENTÓW DOM ---
        const dom = {
            songArtist: document.getElementById('songArtist'),
            songTitle: document.getElementById('songTitle'),
            songId: document.getElementById('songId'),
            songSrc: document.getElementById('songSrc'),
            songCover: document.getElementById('songCover'),
            songGenre: document.getElementById('songGenre'),
            songVersion: document.getElementById('songVersion'),
            songDuration: document.getElementById('songDuration'),
            albumOptions: document.querySelectorAll('input[name="albumAction"]'),
            actionExisting: document.getElementById('actionExisting'),
            actionNew: document.getElementById('actionNew'),
            actionManage: document.getElementById('actionManage'),
            existingAlbumsSelect: document.getElementById('existingAlbumsSelect'),
            newAlbumTitle: document.getElementById('newAlbumTitle'),
            newAlbumDesc: document.getElementById('newAlbumDesc'),
            newAlbumCover: document.getElementById('newAlbumCover'),
            newAlbumSongList: document.getElementById('newAlbumSongList'),
            manageAlbumSelect: document.getElementById('manageAlbumSelect'),
            manageAlbumForm: document.getElementById('manageAlbumForm'),
            manageAlbumTitle: document.getElementById('manageAlbumTitle'),
            manageAlbumDesc: document.getElementById('manageAlbumDesc'),
            manageAlbumCover: document.getElementById('manageAlbumCover'),
            manageAlbumSongList: document.getElementById('manageAlbumSongList'),
            deleteAlbumSection: document.getElementById('deleteAlbumSection'),
            deleteAlbumSelect: document.getElementById('deleteAlbumSelect'),
            generateBtn: document.getElementById('generateBtn'),
            outputSongsJson: document.getElementById('outputSongsJson'),
            outputAlbumsJson: document.getElementById('outputAlbumsJson'),
            downloadSongsBtn: document.getElementById('downloadSongsBtn'),
            downloadAlbumsBtn: document.getElementById('downloadAlbumsBtn'),
        };

        // --- FUNKCJE POMOCNICZE ---

        function slugify(str, separator = '_') {
            if (!str) return '';
            const a = 'àáâäæãåāăąçćčđďèéêëēėęěğǵḧîïíīįìłḿñńǹňôöòóœøōõőṕŕřßśšşșťțûüùúūǘůűųẃẍÿýžźż·/_,:;'
            const b = 'aaaaaaaaaacccddeeeeeeeegghiiiiiilmnnnnoooooooooprrsssssttuuuuuuuuuwxyyzzz------'
            const p = new RegExp(a.split('').join('|'), 'g')

            return str.toString().toLowerCase()
                .replace(/\s+/g, separator) 
                .replace(p, c => b.charAt(a.indexOf(c))) 
                .replace(/&/g, `${separator}and${separator}`) 
                .replace(/[^\w\-]+/g, '') 
                .replace(new RegExp(`\\${separator}\\${separator}+`, 'g'), separator) 
                .replace(new RegExp(`^\\${separator}|\\${separator}$`), ''); 
        }

        function createDownloadLink(filename, content) {
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- GŁÓWNE FUNKCJE APLIKACJI ---

        async function loadInitialData() {
            try {
                const [songsResponse, albumsResponse] = await Promise.all([
                    fetch('songs.json'),
                    fetch('albums.json')
                ]);

                if (!songsResponse.ok) throw new Error(`Nie udało się wczytać songs.json: ${songsResponse.statusText}`);
                if (!albumsResponse.ok) throw new Error(`Nie udało się wczytać albums.json: ${albumsResponse.statusText}`);

                songsData = await songsResponse.json();
                albumsData = await albumsResponse.json();
                
                console.log('Dane zostały pomyślnie wczytane.');
            } catch (error) {
                console.error('Błąd wczytywania danych:', error);
                alert('Nie udało się wczytać plików JSON. Upewnij się, że znajdują się w tym samym folderze co generator. Aplikacja rozpocznie pracę z pustymi danymi.');
                songsData = [];
                albumsData = [];
            } finally {
                updateUI();
            }
        }

        function updateUI() {
            const albumOptionsHTML = albumsData.map(album => `<option value="${album.id}">${album.title}</option>`).join('');
            dom.existingAlbumsSelect.innerHTML = albumOptionsHTML;
            dom.deleteAlbumSelect.innerHTML = albumOptionsHTML;

            dom.manageAlbumSelect.innerHTML = `
                <option value="--create--">-- UTWÓRZ NOWY ALBUM --</option>
                <option value="--delete--">-- USUŃ ISTNIEJĄCY ALBUM --</option>
                <optgroup label="Edytuj istniejący album">
                    ${albumOptionsHTML}
                </optgroup>
            `;
            
            const songCheckboxesHTML = songsData.map(song => `
                <div>
                    <label>
                        <input type="checkbox" name="songSelection" value="${song.id}">
                        ${song.artist} - ${song.title}
                    </label>
                </div>
            `).join('');
            dom.newAlbumSongList.innerHTML = songCheckboxesHTML;
            dom.manageAlbumSongList.innerHTML = songCheckboxesHTML;

            handleManageAlbumChange();
        }
        
        function handleAlbumOptionChange() {
            const selectedAction = document.querySelector('input[name="albumAction"]:checked').value;
            dom.actionExisting.classList.toggle('hidden', selectedAction !== 'existing');
            dom.actionNew.classList.toggle('hidden', selectedAction !== 'new');
            dom.actionManage.classList.toggle('hidden', selectedAction !== 'manage');
        }

        function generateSongId() {
            const artistSlug = slugify(dom.songArtist.value);
            const titleSlug = slugify(dom.songTitle.value);
            dom.songId.value = `${artistSlug}-${titleSlug}`;
        }
        
        function handleManageAlbumChange() {
            const selectedId = dom.manageAlbumSelect.value;
            dom.manageAlbumForm.classList.toggle('hidden', selectedId === '--delete--');
            dom.deleteAlbumSection.classList.toggle('hidden', selectedId !== '--delete--');

            const allCheckboxes = dom.manageAlbumSongList.querySelectorAll('input[type="checkbox"]');
            allCheckboxes.forEach(cb => cb.checked = false);

            if (selectedId === '--create--' || selectedId === '--delete--') {
                dom.manageAlbumTitle.value = '';
                dom.manageAlbumDesc.value = '';
                dom.manageAlbumCover.value = '';
            } else {
                const album = albumsData.find(a => a.id === selectedId);
                if (album) {
                    dom.manageAlbumTitle.value = album.title;
                    dom.manageAlbumDesc.value = album.description || '';
                    dom.manageAlbumCover.value = album.cover || '';
                    album.songs.forEach(songId => {
                        const checkbox = dom.manageAlbumSongList.querySelector(`input[value="${songId}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
            }
        }
        
        function generateCode() {
            let newSongs = JSON.parse(JSON.stringify(songsData));
            let newAlbums = JSON.parse(JSON.stringify(albumsData));
            const selectedAction = document.querySelector('input[name="albumAction"]:checked').value;

            if (['none', 'existing', 'new'].includes(selectedAction)) {
                if (!dom.songArtist.value || !dom.songTitle.value || !dom.songId.value) {
                    alert('Nazwa autora i muzyki są wymagane do utworzenia piosenki!');
                    return;
                }
                const newSong = {
                    id: dom.songId.value,
                    title: dom.songTitle.value,
                    artist: dom.songArtist.value,
                    src: `music/${dom.songSrc.value}`,
                    cover: `images/${dom.songCover.value}`,
                    genre: dom.songGenre.value.split(',').map(g => g.trim()).filter(Boolean),
                    version: dom.songVersion.value,
                    duration: parseInt(dom.songDuration.value, 10) || 0,
                };
                newSongs.push(newSong);
                switch (selectedAction) {
                    case 'existing':
                        const targetAlbum = newAlbums.find(a => a.id === dom.existingAlbumsSelect.value);
                        if (targetAlbum) { targetAlbum.songs.push(newSong.id); }
                        break;
                    case 'new':
                        if (!dom.newAlbumTitle.value) { alert('Tytuł nowego albumu jest wymagany!'); return; }
                        const newAlbumId = slugify(dom.newAlbumTitle.value, '-');
                        const selectedSongIds = Array.from(dom.newAlbumSongList.querySelectorAll('input:checked')).map(cb => cb.value);
                        const newAlbum = {
                            id: newAlbumId,
                            title: dom.newAlbumTitle.value,
                            description: dom.newAlbumDesc.value || '',
                            cover: dom.newAlbumCover.value ? `album-images/${dom.newAlbumCover.value}` : '',
                            songs: [newSong.id, ...selectedSongIds]
                        };
                        newAlbums.push(newAlbum);
                        break;
                }
            } else if (selectedAction === 'manage') {
                const manageAction = dom.manageAlbumSelect.value;
                if (manageAction === '--create--') {
                    if (!dom.manageAlbumTitle.value) { alert('Tytuł nowego albumu jest wymagany!'); return; }
                    const newAlbumId = slugify(dom.manageAlbumTitle.value, '-');
                    const selectedSongIds = Array.from(dom.manageAlbumSongList.querySelectorAll('input:checked')).map(cb => cb.value);
                    const newAlbum = {
                        id: newAlbumId, title: dom.manageAlbumTitle.value, description: dom.manageAlbumDesc.value, cover: dom.manageAlbumCover.value, songs: selectedSongIds };
                    newAlbums.push(newAlbum);
                } else if (manageAction === '--delete--') {
                     const albumIdToDelete = dom.deleteAlbumSelect.value;
                     if(confirm(`Czy na pewno chcesz usunąć album "${albumIdToDelete}"?`)) {
                        newAlbums = newAlbums.filter(a => a.id !== albumIdToDelete);
                     }
                } else {
                    const albumToEdit = newAlbums.find(a => a.id === manageAction);
                    if (albumToEdit) {
                        albumToEdit.title = dom.manageAlbumTitle.value;
                        albumToEdit.id = slugify(albumToEdit.title, '-');
                        albumToEdit.description = dom.manageAlbumDesc.value;
                        albumToEdit.cover = dom.manageAlbumCover.value;
                        albumToEdit.songs = Array.from(dom.manageAlbumSongList.querySelectorAll('input:checked')).map(cb => cb.value);
                    }
                }
            }
            dom.outputSongsJson.value = JSON.stringify(newSongs, null, 4);
            dom.outputAlbumsJson.value = JSON.stringify(newAlbums, null, 4);

            dom.downloadSongsBtn.disabled = false;
            dom.downloadAlbumsBtn.disabled = false;
        }

        // --- INICJALIZACJA I NASŁUCHIWANIE ZDARZEŃ ---
        window.addEventListener('DOMContentLoaded', () => {
            dom.songArtist.addEventListener('input', generateSongId);
            dom.songTitle.addEventListener('input', generateSongId);

            dom.albumOptions.forEach(radio => radio.addEventListener('change', handleAlbumOptionChange));
            
            dom.manageAlbumSelect.addEventListener('change', handleManageAlbumChange);

            dom.generateBtn.addEventListener('click', generateCode);

            dom.downloadSongsBtn.addEventListener('click', () => {
                createDownloadLink('songs.json', dom.outputSongsJson.value);
            });
            dom.downloadAlbumsBtn.addEventListener('click', () => {
                createDownloadLink('albums.json', dom.outputAlbumsJson.value);
            });

            loadInitialData();
        });
    </script>
</body>
</html>
